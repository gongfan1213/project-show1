
### **4.5.1 总述**
跨端交互主要是 PC 端嵌入 Web 页面，内嵌页面包括：
- **创建平台首页**
- **2D 编辑入口页面**
- **3D 编辑入口页面**

交互动作通过 **scheme** 和 **jsbridge** 进行处理。

---

### **4.5.2 流程图**

#### **1. PC 登录状态同步**
当前 PC 端登录 `community.xxxx` 域名接口，而创建平台使用 `makeitxxxxxxxreal` 域名接口，两个 `token` 无法互通。

**解决方案：**
1. **迁移登录实现**：  
   将 `community.exxxx` 的登录实现代码迁移到 `maxxkxxxeitxxxxxxreal` 项目，PC 端替换登录 URL。

2. **新建登录页面**：  
   为 `xxxxxssss` 创建专门针对 PC 的登录页面，登录后调用快速登录接口（`quick login`），并将登录信息保存到本地缓存中。

3. **本地缓存用户信息**：  
   使用创建平台的 2D 编辑器，从本地缓存中获取用户信息。

---

#### **流程图说明**
1. **登录流程**：
   - **1.1** 打开登录页面。
   - **1.2** 调用 `login` 接口。
   - **1.3** 调用 `quick login` 接口。
   - **1.4** 缓存 `token`，用于长期使用。
   - **1.5** 所有流程成功后，将 `token` 返回给 PC 端并保存到本地缓存。

2. **业务访问流程**：
   - **2.1** 访问设备业务（如查询设备、消息等），若返回 `401`，则提示用户退出登录。
   - **2.3** 访问创建平台业务（如云切片业务），若返回 `401`，则提示用户退出登录。
   - **2.4** 访问创建平台业务时，若返回 `401`，提示 PC 端重新登录。

3. **异常处理**：
   - 中间环节失败时，抛出异常反馈。

---

### **4.5.3 接口设计**

#### **1. 通过 jsbridge 通信**
- **指令**：`sendCommandToPc`
- **协议参数**：
  ```json
  {
    "action": "指令参数",
    "data": "携带参数"
  }
  ```
- **说明**：
  - 通用跨端指令格式。
  - 用于发送数据，接入 PC（`xxx_msg`）或 App（``）。

---

#### **2. 通过 scheme 通信**
- **示例**：
  ```text
  project_id=${projectModel?.project_id}&source=${"2dPrint"}&user_id=${getUserInfo()!.user_id}
  ```
- **参数说明**：
  - **source**：触发事件来源（如 2D 打印）。
  - **project_id**：项目 ID。
  - **user_id**：携带用户信息。

- **用途**：
  - 在浏览器的 2D 编辑器中点击打印时，唤起 PC 打印功能。

---

### **总结**
跨端交互设计通过 **jsbridge** 和 **scheme** 实现 PC 与 Web 页面之间的通信，解决了登录状态同步和业务访问问题。通过迁移登录实现、新建登录页面和本地缓存用户信息，确保了跨端交互的流畅性和安全性。
