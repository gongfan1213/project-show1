> ğŸ’­ å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦è¯¦ç»†åˆ†æç”¨æˆ·æä¾›çš„è¿™æ®µä»£ç ï¼Œç‰¹åˆ«æ˜¯`highlightFGBlender`è¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå›¾åƒå¤„ç†å‡½æ•°ï¼Œç”¨OpenCVæ¥å¤„ç†çº¿ç¨¿å›¾å’ŒèƒŒæ™¯å›¾ï¼Œç”Ÿæˆä¸€ä¸ªåˆæˆæ•ˆæœã€‚ç›®æ ‡æ˜¯ç†è§£ä»£ç çš„é€»è¾‘ï¼Œæ‰¾å‡ºæ½œåœ¨é—®é¢˜ï¼Œå¹¶æå‡ºå¯èƒ½çš„æ”¹è¿›å»ºè®®ã€‚
>
> é¦–å…ˆï¼Œé˜…è¯»å‡½æ•°çš„å‚æ•°å’Œæ³¨é‡Šã€‚ç”¨æˆ·æŒ‡å‡ºï¼Œå‡½æ•°ç”¨äºç”Ÿæˆå¼€ç¯æ•ˆæœå›¾ï¼Œç»“åˆäº†å½©å›¾ã€çº¿ç¨¿å›¾å’ŒèƒŒæ™¯å›¾ã€‚å‚æ•°æ˜¯sketchImageï¼ˆçº¿ç¨¿å›¾ï¼‰å’ŒbgImageï¼ˆèƒŒæ™¯+å½©å›¾ï¼‰ï¼Œè¿”å›åˆæˆåçš„å›¾åƒã€‚
>
> è®©æˆ‘çœ‹çœ‹ä»£ç çš„ç»“æ„ï¼š
>
> 1. **æ—¥å¿—è®°å½•**ï¼šå¼€å§‹å’Œç»“æŸæ—¶éƒ½è®°å½•äº†æ—¶é—´æˆ³ï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ€§èƒ½è°ƒè¯•ã€‚
>
> 2. **å¤„ç†é€šé“æ•°**ï¼šå°†fgImageå’ŒbgImageè½¬æ¢ä¸º3é€šé“ï¼Œè¿™æ˜¯å› ä¸ºå¯èƒ½è¾“å…¥çš„å›¾åƒæ˜¯å•é€šé“ï¼ˆå¦‚ç°åº¦ï¼‰æˆ–å››é€šé“ï¼ˆå¦‚å¸¦é€æ˜åº¦çš„BGRAï¼‰ï¼Œéœ€è¦ç»Ÿä¸€åˆ°BGRä¸‰é€šé“ä»¥ä¾¿åç»­çš„æ··åˆæ“ä½œã€‚
>
> 3. **å›¾åƒæ··åˆ**ï¼šä½¿ç”¨`cv.addWeighted`æŒ‰æƒé‡æ··åˆä¸¤ä¸ªå›¾åƒã€‚
>
> 4. **èµ„æºæ¸…ç†**ï¼šé‡Šæ”¾ä¸´æ—¶åˆ›å»ºçš„Matå¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚
>
> 5. **è¿”å›ç»“æœ**ï¼šåˆæˆçš„å›¾åƒmatã€‚
>
> æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦ä¸€æ­¥æ­¥åˆ†ææ¯ä¸ªéƒ¨åˆ†çš„é€»è¾‘æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦å­˜åœ¨æ½œåœ¨é—®é¢˜ã€‚
>
> é¦–å…ˆï¼Œå‡½æ•°å¼€å§‹å£°æ˜weightå˜é‡ï¼Œå›ºå®šä¸ºæŸä¸ªç±»å±æ€§çš„å€¼ï¼Œè¿™å¯èƒ½é™åˆ¶äº†çµæ´»æ€§ã€‚æœ‰æ²¡æœ‰å¿…è¦è®©è¿™ä¸ªå‚æ•°å¯é…ç½®å‘¢ï¼Ÿ
>
> ç„¶åå¤„ç†fgImageçš„é€šé“è½¬æ¢ã€‚å¦‚æœfgImageæ˜¯1é€šé“ï¼ˆç°åº¦å›¾ï¼‰ï¼Œè½¬æ¢ä¸ºBGRä¸‰é€šé“ï¼›å¦‚æœæ˜¯4é€šé“ï¼ˆå¦‚RGBAæˆ–BGRAï¼‰ï¼Œè½¬æ¢ä¸ºBGRï¼Œå»æ‰Alphaé€šé“ã€‚å¦åˆ™ä¿ç•™åŸå›¾ã€‚åŒç†ï¼ŒbgImageå¦‚æœæ˜¯1é€šé“ä¹Ÿè½¬æ¢ä¸ºBGRã€‚è¿™ä¸€æ­¥æ˜¯å¦æ­£ç¡®ï¼Ÿ
>
> è¿™é‡Œæ³¨æ„åˆ°ï¼Œå¯¹äºå››é€šé“çš„fgImageï¼Œè½¬æ¢ä½¿ç”¨çš„æ˜¯cv.COLOR_BGRA2BGRã€‚è¿™è¯´æ˜å‡è®¾è¾“å…¥çš„å›¾åƒæ˜¯BGRAæ ¼å¼ã€‚ä½†å¦‚æœè¾“å…¥çš„å›¾åƒå®é™…ä¸Šæ˜¯RGBAæ ¼å¼ï¼Œé‚£ä¹ˆè¿™æ ·è½¬æ¢ä¼šå¯¼è‡´é¢œè‰²é€šé“é”™è¯¯ï¼ˆRå’ŒBé¢ å€’ï¼‰ã€‚æ¯”å¦‚ï¼Œå¦‚æœè¾“å…¥çš„sketchImageæ˜¯RGBAï¼Œæ­¤æ—¶ç”¨BGRA2BGRè¿›è¡Œè½¬æ¢æ˜¯å¦æ­£ç¡®ï¼Ÿå¯èƒ½éœ€è¦ç¡®ä¿è¾“å…¥å›¾åƒçš„é¢œè‰²æ ¼å¼æ˜¯å¦æ˜¯BGRAã€‚è¿™å¯èƒ½æ˜¯ä¸ªæ½œåœ¨é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¦‚æœå›¾åƒæ¥æºä¸åŒçš„è¯ã€‚
>
> æ¥ä¸‹æ¥ï¼Œåœ¨æ··åˆé˜¶æ®µï¼Œä½¿ç”¨addWeightedå‡½æ•°ï¼ŒäºŒè€…çš„æƒé‡åˆ†åˆ«ä¸ºweightå’Œ1-weightï¼Œgamma=0ã€‚è¿™éƒ¨åˆ†çš„æ··åˆé€»è¾‘æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Ÿæ¯”å¦‚ï¼Œweightçš„å€¼å¦‚æœæ˜¯0.5ï¼Œå°±ä¼šå¹³å‡æ··åˆï¼Œå¦‚æœä¾‹å¦‚ALL_LIGHT_EFFECT_WEIGHTæ˜¯0.8ï¼Œé‚£ä¹ˆèƒŒæ™¯å›¾å æ¯”80%ï¼Œçº¿ç¨¿å›¾20%ã€‚ä½†æ˜¯æ ¹æ®å‡½æ•°çš„ç›®çš„ï¼Œå¯èƒ½æ­£ç¡®çš„æ··åˆæ–¹å¼æ˜¯å¦éœ€è¦æ£€æŸ¥ï¼Ÿæ¯”å¦‚æ˜¯å¦åº”è¯¥æ˜¯çº¿ç¨¿å›¾å’Œé¢œè‰²å›¾çš„å åŠ æ–¹å¼ï¼Ÿæˆ–è€…æ˜¯å¦éœ€è¦å…¶ä»–æ··åˆæ¨¡å¼è€Œä¸æ˜¯ç®€å•çš„åŠ æƒæ··åˆï¼Ÿ
>
> ç„¶åæ˜¯ä¸´æ—¶å¯¹è±¡çš„æ¸…ç†ã€‚è¿™éƒ¨åˆ†ä»£ç æ˜¯å¦æ­£ç¡®é‡Šæ”¾äº†èµ„æºï¼Ÿéœ€è¦çœ‹å„ä¸ªåˆ†æ”¯çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå½“fgImageçš„é€šé“æ•°æ˜¯1æˆ–4æ—¶ï¼Œåˆ›å»ºçš„fgImage3Chä¼šè¢«deleteï¼›åŒç†ï¼ŒbgImageå¦‚æœåŸå…ˆæ˜¯ç°åº¦ï¼Œåˆ›å»ºçš„bgImage3Chä¹Ÿä¼šè¢«deleteã€‚ä½†æ˜¯åœ¨æ··åˆåçš„ç»“æœblenderImageå¹¶æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œè¿™ä¸ªç”±è°ƒç”¨è€…è´Ÿè´£å—ï¼Ÿå¦‚æœè¿™ä¸ªå‡½æ•°è¢«é¢‘ç¹è°ƒç”¨ï¼Œæ˜¯å¦è€ƒè™‘è¿”å›çš„Matå¦‚ä½•ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Ÿ
>
> å†çœ‹çœ‹è¾“å…¥å‚æ•°çš„æ•°æ®ç±»å‹å’Œé”™è¯¯å¤„ç†ã€‚å‡½æ•°å‡è®¾ä¼ å…¥çš„sketchImageå’ŒbgImageéƒ½æ˜¯æœ‰æ•ˆçš„Matå¯¹è±¡ã€‚ä½†å¦‚æœæ²¡æœ‰æ£€æŸ¥è¿™äº›å‚æ•°æ˜¯å¦ä¸ºnullæˆ–æ— æ•ˆçš„Matï¼Œå¯èƒ½ä¼šå¯¼è‡´å´©æºƒã€‚OpenCV.jsçš„Matå¯¹è±¡å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹ä¸ºç©ºï¼Œæˆ–è€…å·²ç»è¢«é‡Šæ”¾ï¼Œè¿™æ—¶å€™è°ƒç”¨channels()æˆ–cvtColorå¯èƒ½ä¼šå‡ºé”™ã€‚
>
> æ­¤å¤–ï¼Œä»£ç ä¸­æ³¨é‡Šæ‰äº†ä¸€éƒ¨åˆ†ï¼Œå³è½¬æ¢ä¸ºbase64è¿”å›ï¼Œå¯èƒ½æ˜¯æ—©æœŸçš„æµ‹è¯•ä»£ç ï¼Œç°åœ¨è¿”å›çš„æ˜¯Matå¯¹è±¡ã€‚ä½†ä¸ºä»€ä¹ˆæœ€åreturn blenderImageï¼Œè¿™ä¸ªæ˜¯å¦éœ€è¦è¢«è°ƒç”¨è€…é‡Šæ”¾ï¼Ÿåœ¨OpenCV.jsä¸­ï¼ŒMatå¯¹è±¡éœ€è¦æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œå¦‚æœè°ƒç”¨è€…å¿˜è®°deleteè¿”å›çš„Matï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚
>
> è¿˜æœ‰å¼‚å¸¸å¤„ç†çš„é—®é¢˜ã€‚æ•´ä¸ªå‡½æ•°æ˜¯asyncçš„ï¼Œä½†ä»£ç ä¸­æ²¡æœ‰try-catchå—ï¼Œå¦‚æœåœ¨cvtColoræˆ–addWeightedä¸­å‘ç”Ÿé”™è¯¯ï¼ˆå¦‚å›¾åƒå°ºå¯¸ä¸åŒ¹é…ï¼‰ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯¼è‡´Promise rejectã€‚ä½†ç”¨æˆ·æ˜¯å¦å¤„ç†äº†è¿™äº›å¼‚å¸¸ï¼Ÿæ˜¯å¦éœ€è¦åœ¨æ­¤å¤„æ•è·å¹¶è®°å½•é”™è¯¯ï¼Ÿ
>
> å¦å¤–ï¼ŒOpenCV.jsçš„å‡½æ•°è°ƒç”¨æ˜¯å¦æ­£ç¡®ï¼Ÿæ¯”å¦‚cvtColorçš„å‚æ•°æ˜¯å¦æ­£ç¡®ã€‚ä¾‹å¦‚ï¼Œæ˜¯å¦åº”è¯¥ä¼ å…¥æ­£ç¡®çš„é¢œè‰²è½¬æ¢ä»£ç ï¼Œæ¯”å¦‚ä»GRAYåˆ°BGRæ˜¯å¦æ­£ç¡®ï¼Ÿ
>
> æ€»ç»“å¯èƒ½çš„æ”¹è¿›ç‚¹ï¼š
>
> 1. **é¢œè‰²ç©ºé—´è½¬æ¢çš„æ­£ç¡®æ€§**ï¼šç¡®è®¤è¾“å…¥çš„å›¾åƒæ˜¯å¦ä¸ºæ­£ç¡®çš„æ ¼å¼ï¼ˆå¦‚BGRAè€ŒéRGBAï¼‰ï¼Œå¿…è¦æ—¶è¿›è¡Œè½¬æ¢ã€‚
>
> 2. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ å‚æ•°æ ¡éªŒï¼Œç¡®ä¿è¾“å…¥çš„sketchImageå’ŒbgImageæ˜¯æœ‰æ•ˆçš„Matå¯¹è±¡ï¼Œå›¾åƒä¸ä¸ºç©ºï¼Œå°ºå¯¸åŒ¹é…ç­‰ã€‚
>
> 3. **å†…å­˜ç®¡ç†**ï¼šç¡®ä¿è¿”å›çš„Matåœ¨ä¸å†ä½¿ç”¨æ—¶è¢«æ­£ç¡®é‡Šæ”¾ï¼Œæˆ–è€…è€ƒè™‘æ˜¯å¦åº”è¯¥å°†è¿”å›çš„Matè½¬æ¢ä¸ºå…¶ä»–å½¢å¼ï¼ˆå¦‚Base64ï¼‰ï¼Œå¹¶åœ¨å‡½æ•°å†…é‡Šæ”¾ã€‚
>
> 4. **æƒé‡å‚æ•°çš„çµæ´»æ€§**ï¼šå¯èƒ½å…è®¸weightä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè€Œä¸æ˜¯å›ºå®šä½¿ç”¨ALL_LIGHT_EFFECT_WEIGHTã€‚
>
> 5. **æ··åˆæ¨¡å¼çš„é€‰æ‹©**ï¼šæ˜¯å¦ä½¿ç”¨å…¶ä»–æ··åˆæ–¹æ³•ï¼ˆå¦‚ä¹˜æ³•ã€å åŠ ï¼‰ä»¥è¾¾åˆ°æ›´å¥½çš„è§†è§‰æ•ˆæœï¼Ÿ
>
> 6. **æ—¥å¿—è®°å½•çš„ä¼˜åŒ–**ï¼šå½“å‰æ—¥å¿—å¯èƒ½åœ¨é¢‘ç¹è°ƒç”¨æ—¶é€ æˆæ€§èƒ½é—®é¢˜ï¼Œæ˜¯å¦éœ€è¦è°ƒæ•´æ—¥å¿—çº§åˆ«æˆ–è¯¦ç»†ä¿¡æ¯ã€‚
>
> 7. **å¼‚å¸¸å¤„ç†å’Œå¼‚æ­¥æ“ä½œçš„å¯é æ€§**ï¼šæ·»åŠ try-catchå—ï¼Œæ•è·å¯èƒ½çš„é”™è¯¯ï¼Œé¿å…æœªå¤„ç†çš„Promise rejectionã€‚
>
> æ¥ä¸‹æ¥ï¼ŒéªŒè¯è¿™äº›æ½œåœ¨é—®é¢˜æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠå¯èƒ½çš„è§£å†³åŠæ³•ã€‚
>
> 



### ä»£ç åŠŸèƒ½åˆ†æ

è¿™æ®µä»£ç æ˜¯ä¸€ä¸ª**åŒå›¾åƒæ··åˆæ–¹æ³•**ï¼Œä¸»è¦ç”¨äºç”Ÿæˆ"å¼€ç¯æ•ˆæœå›¾"ï¼Œå³é€šè¿‡èåˆç°åº¦çº¿ç¨¿ä¸å½©è‰²èƒŒæ™¯å›¾ï¼Œå¾—åˆ°ä¸€ç§å…‰ç…§å¢å¼ºçš„è§†è§‰æ•ˆæœã€‚ä»¥ä¸‹æ˜¯ä»£ç æ ¸å¿ƒåŠŸèƒ½çš„æ‹†è§£ï¼š

---

### 1. è¾“å…¥è¾“å‡ºè§£æ
**è¾“å…¥å‚æ•°**ï¼š
- `sketchImage`ï¼šçº¿ç¨¿å›¾ï¼ˆå‰æ™¯å›¾ï¼‰ï¼Œæ”¯æŒå•é€šé“ï¼ˆç°åº¦ï¼‰æˆ–å››é€šé“ï¼ˆBGRAå¸¦é€æ˜åº¦ï¼‰ã€‚
- `bgImage`ï¼šåŒ…å«èƒŒæ™¯å’Œå½©è‰²æ•ˆæœçš„å›¾åƒï¼Œæ”¯æŒå•é€šé“ï¼ˆç°åº¦ï¼‰æˆ–å¤šé€šé“ï¼ˆå¦‚BGRå½©è‰²ï¼‰ã€‚

**è¾“å‡º**ï¼š
- `blenderImage`ï¼šæ··åˆåçš„ä¸‰é€šé“ï¼ˆBGRï¼‰å›¾åƒçŸ©é˜µï¼ˆOpenCV Matå¯¹è±¡ï¼‰ã€‚

---

### 2. å…³é”®å¤„ç†æ­¥éª¤

#### (1) é€šé“è½¬æ¢ (Channel Conversion)
- **å¤„ç†åŠ¨æœº**ï¼šç¡®ä¿ä¸¤å›¾å‡ä¸º3é€šé“ï¼Œå¦åˆ™æ— æ³•ç›´æ¥æ··åˆã€‚
- **å®ç°é€»è¾‘**ï¼š
  - **å‰æ™¯å›¾å¤„ç†**ï¼š
    - ç°åº¦å›¾ï¼ˆ1é€šé“ï¼‰ â†’ ä½¿ç”¨ `COLOR_GRAY2BGR` è½¬æ¢ä¸º **BGRä¸‰é€šé“**ã€‚
    - BGRAå››é€šé“å›¾ â†’ ä½¿ç”¨ `COLOR_BGRA2BGR` è½¬æ¢ä¸º **BGRä¸‰é€šé“**ï¼ˆä¸¢å¼ƒAlphaé€æ˜åº¦ï¼‰ã€‚
    - å…¶ä»–æƒ…å†µï¼ˆå¦‚ä¸‰é€šé“å›¾ï¼‰ â†’ ç›´æ¥ä½¿ç”¨åŸå›¾ã€‚
  - **èƒŒæ™¯å›¾å¤„ç†**ï¼š
    - ç°åº¦å›¾ï¼ˆ1é€šé“ï¼‰ â†’ è½¬æ¢ä¸º **BGRä¸‰é€šé“**ã€‚
    - éç°åº¦å›¾ â†’ ç›´æ¥ä½¿ç”¨ï¼ˆå‡è®¾è¾“å…¥ä¸ºBGRä¸‰é€šé“ï¼‰ã€‚

#### (2) å›¾åƒæ··åˆ (Blending)
- **ç®—æ³•**ï¼šçº¿æ€§åŠ æƒæ··åˆ (`cv.addWeighted`)ã€‚
- **å…¬å¼**ï¼š
  ```math
  output = bgImage3Ch \times weight + fgImage3Ch \times (1 - weight) + 0
  ```
- **æƒé‡æ§åˆ¶**ï¼š
  - èƒŒæ™¯å›¾æƒé‡ (`weight`) å–å›ºå®šå€¼ `ALL_LIGHT_EFFECT_WEIGHT`ï¼ˆä¾‹å¦‚ 0.7ï¼‰ã€‚
  - çº¿ç¨¿å›¾æƒé‡ä¸º `1 - weight`ã€‚
- **æ•ˆæœ**ï¼šé€šè¿‡è°ƒæ•´æƒé‡ï¼Œæ§åˆ¶èƒŒæ™¯ä¸çº¿ç¨¿çš„è§†è§‰å æ¯”ã€‚æƒé‡è¶Šå¤§ï¼ŒèƒŒæ™¯å›¾å¯¹æœ€ç»ˆæ•ˆæœçš„å½±å“è¶Šå¼ºã€‚

#### (3) èµ„æºæ¸…ç†
- **å†…å­˜é‡Šæ”¾**ï¼šè‹¥è½¬æ¢è¿‡ç¨‹ä¸­åˆ›å»ºäº†ä¸´æ—¶çŸ©é˜µï¼ˆ`fgImage3Ch`ã€`bgImage3Ch`ï¼‰ï¼Œåœ¨æ··åˆå®Œæˆåæ‰‹åŠ¨è°ƒç”¨ `.delete()` é‡Šæ”¾å†…å­˜ï¼Œé¿å…æ³„æ¼ã€‚

---

### 3. æ½œåœ¨é—®é¢˜ä¸æ”¹è¿›å»ºè®®

#### (1) **é¢œè‰²ç©ºé—´å‡è®¾é£é™©**
- **é—®é¢˜**ï¼šä»£ç å‡è®¾è¾“å…¥çš„ **å››é€šé“å›¾æ˜¯BGRAæ ¼å¼**ï¼Œè‹¥å®é™…ä¸ºRGBAï¼ˆWebå¸¸è§æ ¼å¼ï¼‰ï¼Œè½¬æ¢æ—¶å°†å¯¼è‡´ **é¢œè‰²é€šé“é”™ä¹±ï¼ˆçº¢è“åè½¬ï¼‰**ã€‚
- **æ”¹è¿›**ï¼šæ˜ç¡®è¾“å…¥å›¾åƒæ ¼å¼è¦æ±‚æˆ–æ·»åŠ æ ¼å¼æ ¡éªŒã€‚

#### (2) **è¾“å…¥å®¹é”™æ€§ä¸è¶³**
- **é—®é¢˜**ï¼šæœªæ ¡éªŒè¾“å…¥å›¾åƒæ˜¯å¦å­˜åœ¨ï¼ˆå¦‚ä¼ å…¥ç©ºçŸ©é˜µï¼‰ã€å°ºå¯¸æ˜¯å¦åŒ¹é…ã€æ˜¯å¦ä¸ºæœ‰æ•ˆMatå¯¹è±¡ã€‚
- **æ”¹è¿›**ï¼š
  ```typescript
  if (!sketchImage || sketchImage.empty() || !bgImage || bgImage.empty()) {
    throw new Error('Invalid input mats');
  }
  ```

#### (3) **æƒé‡çµæ´»æ€§ç¼ºå¤±**
- **é—®é¢˜**ï¼š`weight` ç¡¬ç¼–ç ä¸ºç±»å±æ€§ï¼Œæ— æ³•åŠ¨æ€è°ƒæ•´æ··åˆæ•ˆæœã€‚
- **æ”¹è¿›**ï¼šå°† `weight` ä½œä¸ºå¯é€‰å‚æ•°ï¼Œå…è®¸è°ƒç”¨æ–¹è‡ªå®šä¹‰ï¼š
  ```typescript
  private async highlightFGBlender(
    sketchImage: any, 
    bgImage: any,
    weight: number = this.ALL_LIGHT_EFFECT_WEIGHT
  ): Promise<any> {
    // ...
  }
  ```

#### (4) **è¿”å›èµ„æºæ³„æ¼é£é™©**
- **é—®é¢˜**ï¼šè¿”å›çš„ `blenderImage` Mat å¯¹è±¡éœ€ç”±è°ƒç”¨è€…æ‰‹åŠ¨é‡Šæ”¾ï¼Œä½†æœªåœ¨æ¥å£æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ã€‚
- **æ”¹è¿›**ï¼š
  - æ·»åŠ æ³¨é‡Šæ˜ç¡®é‡Šæ”¾è´£ä»»ã€‚
  - æˆ–è¿”å›Base64å­—ç¬¦ä¸²ï¼ˆè°ƒç”¨å†…éƒ¨æ¸…ç†ï¼‰ï¼š
    ```typescript
    const resultBase64 = await this.matToBase64(blenderImage);
    blenderImage.delete(); // ç«‹å³é‡Šæ”¾
    return resultBase64;
    ```

#### (5) **æ··åˆæ¨¡å¼å•ä¸€**
- **é—®é¢˜**ï¼šä»…ä½¿ç”¨çº¿æ€§æ··åˆ (`addWeighted`)ï¼Œæ— æ³•å®ç°æ›´å¤æ‚çš„èåˆæ•ˆæœï¼ˆå¦‚æ­£ç‰‡å åº•ã€æŸ”å…‰ï¼‰ã€‚
- **æ”¹è¿›**ï¼šæ”¯æŒå¤šç§æ··åˆæ¨¡å¼ï¼š
  ```typescript
  enum BlendMode { Linear, Multiply, Overlay }
  private async highlightFGBlender(..., mode: BlendMode = BlendMode.Linear) {
    switch (mode) {
      case BlendMode.Linear: 
        cv.addWeighted(...);
        break;
      case BlendMode.Multiply:
        cv.multiply(bgImage3Ch, fgImage3Ch, blenderImage);
        break;
      // ...
    }
  }
  ```

---

### 4. ä¼˜åŒ–åä»£ç ç¤ºä¾‹

```typescript
private async highlightFGBlender(
  sketchImage: any, 
  bgImage: any,
  weight: number = this.ALL_LIGHT_EFFECT_WEIGHT
): Promise<any> {
  ConsoleUtil.log('=====highlightFGBlender===start', new Date().toISOString(), bgImage);

  // è¾“å…¥æ ¡éªŒ
  if (!sketchImage || sketchImage.empty() || !bgImage || bgImage.empty()) {
    throw new Error('Invalid input matrices');
  }

  let fgImage3Ch: any;
  let bgImage3Ch: any;

  // è½¬æ¢å‰æ™¯å›¾è‡³ä¸‰é€šé“
  switch (sketchImage.channels()) {
    case 1: // Grayscale
      fgImage3Ch = new this.cv.Mat();
      this.cv.cvtColor(sketchImage, fgImage3Ch, this.cv.COLOR_GRAY2BGR);
      break;
    case 4: // BGRA (å‡è®¾è¾“å…¥ä¸ºBGRAæ ¼å¼)
      fgImage3Ch = new this.cv.Mat();
      this.cv.cvtColor(sketchImage, fgImage3Ch, this.cv.COLOR_BGRA2BGR);
      break;
    default:
      fgImage3Ch = sketchImage; // ç›´æ¥ä½¿ç”¨ä¸‰é€šé“
  }

  // è½¬æ¢èƒŒæ™¯å›¾è‡³ä¸‰é€šé“
  if (bgImage.channels() === 1) {
    bgImage3Ch = new this.cv.Mat();
    this.cv.cvtColor(bgImage, bgImage3Ch, this.cv.COLOR_GRAY2BGR);
  } else {
    bgImage3Ch = bgImage;
  }

  // éªŒè¯å°ºå¯¸ä¸€è‡´æ€§
  if (fgImage3Ch.rows !== bgImage3Ch.rows || fgImage3Ch.cols !== bgImage3Ch.cols) {
    throw new Error('Image dimensions do not match');
  }

  // æ··åˆå›¾åƒ
  const blenderImage = new this.cv.Mat();
  this.cv.addWeighted(bgImage3Ch, weight, fgImage3Ch, 1 - weight, 0, blenderImage);

  // æ¸…ç†ä¸´æ—¶çŸ©é˜µ
  if (fgImage3Ch !== sketchImage) fgImage3Ch.delete();
  if (bgImage3Ch !== bgImage) bgImage3Ch.delete();

  ConsoleUtil.log('=====highlightFGBlender===end', new Date().toISOString());
  return blenderImage; // è°ƒç”¨è€…éœ€æ‰‹åŠ¨ delete()
}
```

---

### 5. æ€»ç»“

**ä»£ç äº®ç‚¹**ï¼š
- **å†…å­˜ç®¡ç†è§„èŒƒ**ï¼šåŠæ—¶é‡Šæ”¾ä¸´æ—¶Matå¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚
- **é€šé“å…¼å®¹æ€§å¼º**ï¼šæ”¯æŒå¤šç§è¾“å…¥æ ¼å¼ï¼Œæé«˜å¤ç”¨æ€§ã€‚

**æ ¸å¿ƒä¼˜åŒ–æ–¹å‘**ï¼š
- **é”™è¯¯å¤„ç†**ï¼šå¢å¼ºè¾“å…¥æ ¡éªŒä¸å¼‚å¸¸æ•è·ã€‚
- **æ¥å£è®¾è®¡**ï¼šæ˜ç¡®èµ„æºé‡Šæ”¾è´£ä»»æˆ–è‡ªåŠ¨åŒ–æ¸…ç†ã€‚
- **çµæ´»æ€§æ‰©å±•**ï¼šå…è®¸åŠ¨æ€è°ƒèŠ‚å‚æ•°ï¼ˆæƒé‡ã€æ··åˆæ¨¡å¼ç­‰ï¼‰ã€‚
