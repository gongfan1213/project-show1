```js
 /**
     * æ ¹æ®äºŒå€¼å›¾å¾—åˆ°è½®å»“svg
     *  */
    public async getOutlineImg(imageStr: string, outlineImgType: OutlineImgType = OutlineImgType.out_line_img_type_1, strokeWidth: number = 20, strokeColor: string = '#33BF5A') {
        // Convert base64 string to HTMLImageElement
        const image = await this.base64ToImage(imageStr);

        const src = this.cv.imread(image);
        const gray = new this.cv.Mat();
        const binary = new this.cv.Mat();
        const contours = new this.cv.MatVector();
        const hierarchy = new this.cv.Mat();

        this.cv.cvtColor(src, gray, this.cv.COLOR_RGBA2GRAY, 0);
        this.cv.threshold(gray, binary, 0, 255, this.cv.THRESH_BINARY);
        this.cv.findContours(binary, contours, hierarchy, this.cv.RETR_EXTERNAL, this.cv.CHAIN_APPROX_TC89_KCOS);
        let resultImage: string;

        if (outlineImgType !== OutlineImgType.out_line_img_type_1) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            if (outlineImgType === OutlineImgType.out_line_img_type_2) {
                canvas.width = src.cols + strokeWidth;
                canvas.height = src.rows + strokeWidth;
                if (ctx) {
                    ctx.strokeStyle = strokeColor;
                    ctx.lineWidth = strokeWidth;
                    for (let i = 0; i < contours.size(); ++i) {
                        const contour = contours.get(i);
                        ctx.beginPath();
                        for (let j = 0; j < contour.rows; ++j) {
                            const x = contour.data32S[j * 2];
                            const y = contour.data32S[j * 2 + 1];
                            if (j === 0) {
                                ctx.moveTo(x + strokeWidth / 2, y + strokeWidth / 2);
                            } else {
                                ctx.lineTo(x + strokeWidth / 2, y + strokeWidth / 2);
                            }
                        }
                        ctx.closePath();
                        ctx.stroke();
                    }
                    ctx.drawImage(image, strokeWidth / 2, strokeWidth / 2, src.cols, src.rows);
                }
            } else {
                canvas.width = src.cols;
                canvas.height = src.rows;
                if (ctx) {
                    ctx.strokeStyle = strokeColor;
                    ctx.lineWidth = strokeWidth;
                    for (let i = 0; i < contours.size(); ++i) {
                        const contour = contours.get(i);
                        ctx.beginPath();
                        for (let j = 0; j < contour.rows; ++j) {
                            const x = contour.data32S[j * 2];
                            const y = contour.data32S[j * 2 + 1];
                            if (j === 0) {
                                ctx.moveTo(x, y);
                            } else {
                                ctx.lineTo(x, y);
                            }
                        }
                        ctx.closePath();
                        ctx.stroke();
                    }
                    // ctx.globalCompositeOperation = 'source-out';
                    ctx.drawImage(image, 0, 0, src.cols, src.rows);
                }
            }
            resultImage = canvas.toDataURL('image/png');
            canvas.width = 0;
            canvas.height = 0;
        } else {
            const svgContent = this.contoursOutLineToSVG(contours, src.cols, src.rows, strokeColor, strokeWidth);
            resultImage = svgContent;
        }
        // Clean up
        src.delete();
        gray.delete();
        binary.delete();
        contours.delete();
        hierarchy.delete();
        return resultImage;
    }
```


> ğŸ’­ ä»Šå¤©æ”¶åˆ°äº†ç”¨æˆ·çš„é—®é¢˜ï¼Œæˆ‘éœ€è¦å¸®ä»–é‡æ–°åˆ†æ`getOutlineImg`æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯æ ¹æ®ç”¨æˆ·æä¾›çš„`OutlineImgType`æšä¸¾å€¼æ¥è°ƒæ•´ä¹‹å‰çš„ç†è§£ã€‚ç”¨æˆ·ä¹‹å‰è¯´ä¹‹å‰çš„åˆ†ææœ‰è¯¯ï¼Œç‰¹åˆ«æ˜¯å…³äº`outlineImgType`å‚æ•°çš„å«ä¹‰ã€‚
>
> é¦–å…ˆï¼Œæˆ‘å¾—ä»”ç»†çœ‹ä¸€ä¸‹æšä¸¾å®šä¹‰ï¼š
>
> ```typescript
>
> export enum OutlineImgType {
>
>   out_line_img_type_1 = 0, // è·å–è½®å»“çº¿
>
>   out_line_img_type_2 = 1, // è·å–è½®å»“çº¿+åŸå›¾å¤–æ‰©
>
>   out_line_img_type_3 = 2, // è·å–è½®å»“çº¿+åŸå›¾å†…ç¼©
>
> }
>
> ```
>
> è¿™è¯´æ˜åŸæ¥çš„ç±»å‹0æ˜¯åªè·å–è½®å»“çº¿ï¼Œç±»å‹1æ˜¯è½®å»“çº¿åŠ åŸå›¾å¤–æ‰©ï¼Œç±»å‹2æ˜¯è½®å»“çº¿åŠ åŸå›¾å†…ç¼©ã€‚ä¹‹å‰çš„åˆ†æä¸­ï¼Œç”¨æˆ·å¯èƒ½æ²¡æœ‰æ­£ç¡®ç†è§£ç±»å‹2å’Œç±»å‹3çš„å¤„ç†ï¼Œå°¤å…¶æ˜¯åŸå›¾å¤–æ‰©å’Œå†…ç¼©çš„åŒºåˆ«ã€‚
>
> ç°åœ¨éœ€è¦é‡æ–°å®¡è§†ä»£ç ä¸­ä¸åŒç±»å‹çš„å¤„ç†é€»è¾‘ã€‚ä¹‹å‰ç”¨æˆ·æåˆ°å½“`outlineImgType`ä¸æ˜¯1æ—¶ï¼Œæ‰§è¡Œç”ŸæˆCanvasçš„æ“ä½œã€‚ä½†æ ¹æ®æšä¸¾çš„å®šä¹‰ï¼Œç±»å‹0ã€1ã€2åˆ†åˆ«å¯¹åº”ä¸åŒçš„æ¨¡å¼ï¼Œå¯èƒ½éœ€è¦æ›´è¯¦ç»†çš„åŒºåˆ†ã€‚
>
> é¦–å…ˆï¼Œç±»å‹0æ˜¯ä»…ç”Ÿæˆè½®å»“çº¿çš„SVGã€‚æ ¹æ®åŸæ¥çš„ä»£ç é€»è¾‘ï¼Œå½“ç±»å‹ä¸º0æ—¶ï¼Œè°ƒç”¨`contoursOutLineToSVG`ç”ŸæˆSVGã€‚è¿™éƒ¨åˆ†å¯èƒ½æ²¡é—®é¢˜ï¼Œä½†ç°åœ¨éœ€è¦ç¡®è®¤ç±»å‹0æ˜¯å¦æ­£ç¡®å¤„ç†ã€‚
>
> ç±»å‹1ï¼ˆåŸå›¾å¤–æ‰©ï¼‰æ„å‘³ç€åœ¨Canvasä¸­æ·»åŠ è½®å»“çº¿ï¼Œå¹¶ä¸”å°†åŸå›¾å‘å¤–æ‰©å±•ï¼Œå¯èƒ½éœ€è¦æ›´å¤§çš„ç”»å¸ƒï¼Œç¤ºä¾‹ä»£ç ä¸­ç±»å‹1å¯¹åº”çš„æ˜¯ç”»å¸ƒå°ºå¯¸å¢åŠ `strokeWidth`ï¼Œå³åœ¨åŸå›¾å°ºå¯¸åŸºç¡€ä¸ŠåŠ ä¸Šæè¾¹å®½åº¦ï¼Œè€ŒåŸå›¾çš„ä½ç½®åº”è¯¥æ˜¯åç§»`strokeWidth/2`ï¼Œå¯èƒ½è¿™å°±æ˜¯å¤–æ‰©çš„è¡¨ç°ã€‚
>
> ç±»å‹2ï¼ˆåŸå›¾å†…ç¼©ï¼‰åˆ™ç›¸åï¼Œå¯èƒ½éœ€è¦åŸå›¾åœ¨å†…éƒ¨æ”¶ç¼©ï¼Œé‚£ä¹ˆç”»å¸ƒå°ºå¯¸å¯èƒ½ä¸éœ€è¦å¢åŠ ï¼Œè€Œæ˜¯åœ¨åŸå›¾å°ºå¯¸åŸºç¡€ä¸Šç»˜åˆ¶è½®å»“ï¼Œä½¿å¾—åŸå›¾åœ¨è½®å»“å†…éƒ¨æ˜¾ç¤ºï¼Œæ­¤æ—¶å¯èƒ½éœ€è¦ä¿®æ”¹åŸå›¾çš„ä½ç½®æˆ–å°ºå¯¸ï¼Œæˆ–è€…é€šè¿‡åˆæˆæ“ä½œï¼ˆæ¯”å¦‚ä½¿ç”¨`globalCompositeOperation`ï¼‰æ¥è®©åŸå›¾å†…ç¼©ã€‚
>
> ä½†åœ¨åŸå…ˆçš„ä»£ç ä¸­ï¼Œå¤„ç†ç±»å‹é1çš„æƒ…å†µæ—¶ï¼Œç”»å¸ƒçš„å°ºå¯¸å¹¶æ²¡æœ‰æ ¹æ®ç±»å‹è¿›è¡Œä¸åŒçš„è°ƒæ•´ï¼Œå¯èƒ½å¯¼è‡´å¤–æ‰©å’Œå†…ç¼©çš„æ•ˆæœä¸æ­£ç¡®ã€‚æ¯”å¦‚ç±»å‹3ï¼ˆå¯¹åº”åŸç±»å‹2ï¼‰å¯èƒ½ä¸é¢„æœŸä¸ç¬¦ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›åœ¨è¿›è¡Œå†…ç¼©æ—¶è°ƒæ•´åŸå›¾çš„ç»˜åˆ¶ä½ç½®æˆ–å¤§å°ã€‚
>
> ç›®å‰ï¼ŒåŸä»£ç ä¸­ï¼š
>
> - ç±»å‹é1æ—¶ï¼Œåˆ›å»ºä¸åŸå›¾å°ºå¯¸ç›¸åŒçš„ç”»å¸ƒã€‚
>
> - ç±»å‹ä¸º1æ—¶ï¼Œç”»å¸ƒå°ºå¯¸å¢åŠ `strokeWidth`ï¼Œå¹¶é€šè¿‡åç§»ç»˜åˆ¶åŸå›¾ã€‚
>
> è¿™å¯èƒ½ä¸ç”¨æˆ·å®šä¹‰çš„æšä¸¾æ„å›¾ä¸ç¬¦ï¼Œç‰¹åˆ«æ˜¯ç±»å‹2ï¼ˆ`out_line_img_type_3`ï¼‰çš„å†…ç¼©éœ€æ±‚ã€‚éœ€è¦è°ƒæ•´ä»£ç æ¥æ­£ç¡®å¤„ç†è¿™ä¸‰ç§ç±»å‹ã€‚
>
> ä¾‹å¦‚ï¼Œç±»å‹0å¯èƒ½ä»…ç”ŸæˆSVGè½®å»“ï¼Œè€Œç±»å‹1ç”Ÿæˆå¤–æ‰©çš„Canvaså›¾åƒï¼Œç±»å‹2å¯èƒ½éœ€è¦å†…ç¼©å¤„ç†ï¼Œå¯èƒ½é€šè¿‡å…ˆç»˜åˆ¶åŸå›¾ï¼Œå†åœ¨å†…éƒ¨ç”¨æŸç§æ–¹å¼ç»˜åˆ¶è½®å»“çº¿ï¼Œæˆ–è€…é€šè¿‡åˆæˆæ¨¡å¼è®©è½®å»“çº¿åœ¨åŸå›¾å†…éƒ¨æ˜¾ç¤ºã€‚
>
> è¿˜éœ€è¦æ£€æŸ¥ç¤ºä¾‹ä»£ç ä¸­æ˜¯å¦ä¼šå‡ºç°ç±»å‹è¢«é”™è¯¯å¤„ç†çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼ŒåŸä»£ç çš„æ¡ä»¶æ£€æŸ¥æ˜¯å¦ä¸ºç±»å‹1æ¥å†³å®šæ˜¯å¦æ‰©å±•Canvaså’Œè°ƒæ•´åŸå›¾ä½ç½®ã€‚å¦‚æœç”¨æˆ·ä¼ é€’çš„æ˜¯ç±»å‹2ï¼Œå°±ä¼šè¢«å½’ç±»åˆ°â€œå…¶ä»–â€ï¼Œå¯¼è‡´ç”»å¸ƒå°ºå¯¸ä¸æ”¹å˜ï¼ŒåŸå›¾ç»˜åˆ¶åœ¨åŸç‚¹ï¼Œå½±å“æ•ˆæœã€‚
>
> éœ€è¦é‡æ–°æ¢³ç†æ¯ä¸ªç±»å‹å¯¹åº”çš„é€»è¾‘ï¼š
>
> - **out_line_img_type_1 (0)**: åªç”ŸæˆSVGè½®å»“çº¿ã€‚
>
>   - ä½¿ç”¨`contoursOutLineToSVG`ç”ŸæˆSVGå­—ç¬¦ä¸²ã€‚
>
>   
>
> - **out_line_img_type_2 (1)**: è½®å»“çº¿+åŸå›¾å¤–æ‰©ã€‚
>
>   - åˆ›å»ºæ›´å¤§çš„Canvasï¼ˆåŸå°ºå¯¸ + `strokeWidth`ï¼‰ã€‚
>
>   - ç»˜åˆ¶è½®å»“çº¿ï¼ˆå¯èƒ½éœ€è¦æ ¹æ®æ‰©å±•çš„ç”»å¸ƒè°ƒæ•´ä½ç½®ï¼‰ã€‚
>
>   - ç»˜åˆ¶åŸå›¾ï¼Œä½ç½®åç§»`strokeWidth/2`ï¼Œä½¿åŸå›¾å‘å¤–æ‰©å±•ï¼Œç•™å‡ºæè¾¹ç©ºé—´ã€‚
>
> - **out_line_img_type_3 (2)**: è½®å»“çº¿+åŸå›¾å†…ç¼©ã€‚
>
>   - å¯èƒ½éœ€è¦åŸå›¾åœ¨åŸå°ºå¯¸çš„ç”»å¸ƒä¸­ç¼©å°ï¼Œè…¾å‡ºè¾¹ç¼˜ç»™è½®å»“çº¿ã€‚
>
>   - å®ç°æ–¹æ³•å¯èƒ½æœ‰ä¸¤ç§ï¼š
>
>     1. åŸå›¾ç¼©å°ç»˜åˆ¶ï¼Œå‘¨å›´ç•™å‡ºç©ºé—´ç»˜åˆ¶è½®å»“çº¿ã€‚
>
>     2. ä½¿ç”¨åˆæˆæ“ä½œï¼ˆå¦‚`source-over`å…ˆç»˜åˆ¶è½®å»“çº¿ï¼Œå†ç»˜åˆ¶åŸå›¾åœ¨å…¶å†…éƒ¨ï¼‰ã€‚
>
> æ­¤æ—¶åŸä»£ç åœ¨å¤„ç†ç±»å‹2æ—¶å¯èƒ½æ²¡æœ‰æ­£ç¡®å¤„ç†å†…ç¼©çš„æƒ…å†µã€‚æ¯”å¦‚åŸå›¾çš„ç»˜åˆ¶ä½ç½®å¯èƒ½éœ€è¦è°ƒæ•´ï¼Œæˆ–è€…åœ¨ç»˜åˆ¶åŸå›¾æ—¶ç¼©å°å°ºå¯¸ã€‚åŸä»£ç ä¸­çš„å…¶ä»–æ¨¡å¼éƒ¨åˆ†å¯èƒ½æ²¡æœ‰å¤„ç†å†…ç¼©çš„é€»è¾‘ï¼Œå¯¼è‡´ç»“æœä¸é¢„æœŸä¸ç¬¦ã€‚
>
> å› æ­¤ï¼Œå­˜åœ¨çš„ä¸»è¦é—®é¢˜å¯èƒ½æ˜¯ç±»å‹2æ²¡æœ‰å¾—åˆ°æ­£ç¡®çš„å¤„ç†ï¼Œç¼ºå°‘å†…ç¼©çš„ç»˜åˆ¶é€»è¾‘ã€‚éœ€è¦æ ¹æ®ä¸åŒç±»å‹è°ƒæ•´ç»˜åˆ¶åŸå›¾çš„å°ºå¯¸æˆ–ä½ç½®ï¼Œä»¥åŠå¯èƒ½çš„ç”»å¸ƒå°ºå¯¸ã€‚
>
> æ­¤å¤–ï¼Œç”¨æˆ·åœ¨æ³¨è§£ä¸­æåˆ°`globalCompositeOperation`ä»£ç è¢«æ³¨é‡Šï¼Œå¯èƒ½éœ€è¦å¯ç”¨å¹¶æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒçš„åˆæˆæ¨¡å¼ï¼Œä»¥è¾¾åˆ°å†…ç¼©æˆ–å¤–æ‰©æ•ˆæœã€‚ä¾‹å¦‚ï¼Œç±»å‹1å¯èƒ½å¸Œæœ›è½®å»“çº¿å›´ç»•åœ¨åŸå›¾å¤–ä¾§ï¼Œç±»å‹2å¸Œæœ›è½®å»“çº¿åœ¨åŸå›¾å†…ä¾§ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹ç»˜å›¾é¡ºåºå’Œåˆæˆæ¨¡å¼ã€‚
>
> ä¾‹å¦‚ï¼Œå¯¹äºç±»å‹2ï¼ˆå†…ç¼©ï¼‰ï¼š
>
> 1. å…ˆç»˜åˆ¶åŸå›¾ã€‚
>
> 2. ç„¶åç»˜åˆ¶è½®å»“çº¿åœ¨åŸå›¾å†…éƒ¨ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨`clip`æˆ–åˆæˆæ¨¡å¼æ¥é™åˆ¶è½®å»“çº¿åœ¨åŸå›¾å†…éƒ¨æ˜¾ç¤ºã€‚æˆ–è€…ï¼Œå°†åŸå›¾å°ºå¯¸ç¼©å°ï¼Œè…¾å‡ºè¾¹ç¼˜ç©ºé—´æ¥ç»˜åˆ¶è½®å»“çº¿ã€‚
>
> å¯èƒ½éœ€è¦è°ƒæ•´åŸå›¾åœ¨Canvasä¸­çš„ç»˜åˆ¶å°ºå¯¸ã€‚ä¾‹å¦‚ï¼Œç±»å‹2çš„ç”»å¸ƒä¿æŒåŸå¤§å°ï¼Œä½†åŸå›¾ç»˜åˆ¶æ—¶çš„å°ºå¯¸ç¼©å°åˆ°`src.cols - strokeWidth*2`, `src.rows - strokeWidth*2`ï¼Œä½ç½®å±…ä¸­ï¼Œè¿™æ ·å‘¨å›´çš„ç©ºé—´å¯ä»¥ç”¨æ¥ç»˜åˆ¶è½®å»“çº¿ã€‚
>
> ä½†åŸä»£ç ä¸­çš„ç»˜å›¾æ–¹å¼ä»…ä»…æ˜¯ç»˜åˆ¶è·¯å¾„å¹¶strokeï¼Œè€ŒåŸå›¾çš„ç»˜åˆ¶æ˜¯ç›´æ¥æ‹‰ä¼¸æˆ–ä¿æŒåŸå°ºå¯¸ï¼Œè¿™å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚
>
> æ€»ç»“éœ€è¦ä¼˜åŒ–çš„æ­¥éª¤ï¼š
>
> 1. **ç±»å‹åˆ¤æ–­åˆ†æ”¯**ï¼š
>
>    - éœ€è¦æ ¹æ®`outlineImgType`çš„å€¼åˆ†åˆ«å¤„ç†ä¸‰ç§æƒ…å†µï¼Œè€Œä¸æ˜¯åŸå…ˆçš„æ˜¯å¦ä¸º1çš„åˆ¤æ–­ã€‚
>
>    
>
> 2. **è°ƒæ•´Canvaså°ºå¯¸å’ŒåŸå›¾ä½ç½®/å¤§å°**ï¼š
>
>    - ç±»å‹1ï¼ˆå¤–æ‰©ï¼‰ï¼šCanvasæ‰©å¤§ï¼ŒåŸå›¾åç§»ã€‚
>
>    - ç±»å‹2ï¼ˆå†…ç¼©ï¼‰ï¼šCanvasä¿æŒåŸå°ºå¯¸ï¼ŒåŸå›¾ç¼©å°å¹¶å±…ä¸­ï¼Œè…¾å‡ºè¾¹ç¼˜ç©ºé—´ç»˜åˆ¶è½®å»“çº¿ã€‚
>
>    
>
> 3. **ç»˜å›¾é¡ºåºå’Œåˆæˆæ¨¡å¼**ï¼š
>
>    - å¯èƒ½éœ€è¦å…ˆç»˜åˆ¶è½®å»“çº¿å†ç»˜åˆ¶åŸå›¾ï¼Œæˆ–è€…ç›¸åï¼Œç»“åˆåˆæˆæ¨¡å¼è¾¾åˆ°é¢„æœŸæ•ˆæœã€‚
>
> ç°åœ¨éœ€è¦é‡æ–°æ„å»ºä»£ç é€»è¾‘ï¼Œå¯èƒ½å°†åŸå¤„ç†éç±»å‹1çš„æƒ…å†µæ‹†åˆ†æˆç±»å‹0ã€2çš„ä¸åŒå¤„ç†ã€‚æˆ–è€…ï¼Œé€šè¿‡æ›´è¯¦ç»†çš„æ¡ä»¶åˆ†æ”¯æ¥å¤„ç†ä¸‰ç§ç±»å‹ã€‚
>
> å¦å¤–ï¼ŒSVGç”Ÿæˆï¼ˆç±»å‹0ï¼‰å¯èƒ½éœ€è¦å•ç‹¬å¤„ç†ï¼Œè€Œç±»å‹1å’Œ2ä¸ºCanvasç»˜åˆ¶ï¼Œç¬¬ä¸‰ç§ç±»å‹ï¼ˆä½†ç›®å‰æšä¸¾ä¼¼ä¹ä¸‰ç§ç±»å‹ä¸­ç±»å‹0,1,2ï¼‰å¯èƒ½éœ€è¦åŒºåˆ†ã€‚
>
> å¯èƒ½çš„ä»£ç ç»“æ„ï¼š
>
> ```typescript
>
> if (outlineImgType === OutlineImgType.out_line_img_type_1) { 
>
>   // ç”ŸæˆSVG 
>
> } 
>
> else { 
>
>   // Canvaså¤„ç† 
>
>   if (outlineImgType === OutlineImgType.out_line_img_type_2) { 
>
>     // å¤–æ‰©é€»è¾‘ 
>
>   } else if (outlineImgType === OutlineImgType.out_line_img_type_3) { 
>
>     // å†…ç¼©é€»è¾‘ 
>
>   } 
>
> } 
>
> ```
>
> åœ¨å†…ç¼©é€»è¾‘ä¸­ï¼Œéœ€è¦è°ƒæ•´åŸå›¾çš„ç»˜åˆ¶ï¼Œæ¯”å¦‚ç»˜åˆ¶åœ¨ä¸­å¿ƒï¼Œå¤§å°ç¼©å°ï¼Œæˆ–è€…ç»˜åˆ¶è½®å»“çº¿è¦†ç›–åœ¨åŸå›¾å†…ä¾§ã€‚
>
> ä¾‹å¦‚ï¼Œå†…ç¼©å¤„ç†å¯èƒ½ï¼š
>
> - åŸå›¾ç»˜åˆ¶ä¸º`src.cols - strokeWidth`, `src.rows - strokeWidth`ï¼Œå¹¶åœ¨ä¸­é—´ä½ç½®ã€‚
>
> - ç„¶ååœ¨åŸå›¾çš„ä½ç½®åŸºç¡€ä¸Šå‘å¤–æ‰©å±•è½®å»“çº¿ï¼Œæˆ–è€…è·¯å¾„å‘å†…åç§»ã€‚
>
> è¿™å¯èƒ½éœ€è¦ä¿®æ”¹è½®å»“ç‚¹çš„åæ ‡ï¼Œæˆ–è€…åœ¨ç»˜åˆ¶è½®å»“æ—¶ç¼©å°åŒºåŸŸã€‚
>
> è¿™å¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºè½®å»“æ˜¯åœ¨åŸå›¾è¾¹ç¼˜æå–çš„ï¼Œè‹¥è¦åœ¨å†…ç¼©æƒ…å†µä¸‹æ˜¾ç¤ºï¼Œå¯èƒ½éœ€è¦å°†è½®å»“çº¿å‘å†…åç§»ä¸€å®šè·ç¦»ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`cv2.offsetPolygon`æˆ–ç±»ä¼¼æ“ä½œï¼‰ï¼Œä½†åœ¨OpenCV.jsä¸­æ˜¯å¦æœ‰æ­¤ç±»å‡½æ•°ï¼Ÿ
>
> æˆ–è€…åœ¨ç»˜åˆ¶è½®å»“çº¿æ—¶ï¼Œæ§åˆ¶çº¿æ¡çš„å®½åº¦å’Œä½ç½®ã€‚ä¾‹å¦‚ï¼Œå°†è·¯å¾„å‘å†…åç§»`strokeWidth/2`ï¼Œä½¿è½®å»“çº¿ç»˜åˆ¶åœ¨åŸå›¾å†…ä¾§ã€‚
>
> è¿™éœ€è¦æ•°å­¦è®¡ç®—ï¼Œå¯èƒ½æ¯éƒ½éœ€è¦è°ƒæ•´æ¯ä¸ªç‚¹çš„åæ ‡ï¼Œä½¿è·¯å¾„å‘å†…æ”¶ç¼©ã€‚
>
> ç„¶è€Œï¼Œè¿™å¯èƒ½åœ¨å®æ—¶å¤„ç†ä¸­è¾ƒéš¾å®ç°ï¼Œå°¤å…¶å¯¹äºå¤æ‚å½¢çŠ¶ã€‚ä¸€ç§å˜é€šæ–¹æ³•æ˜¯ä½¿ç”¨Canvasçš„`clip`æ–¹æ³•ï¼Œå…ˆç»˜åˆ¶åŸå›¾å¹¶å»ºç«‹è£å‰ªåŒºåŸŸï¼Œå†ç»˜åˆ¶è½®å»“çº¿ä»…é™äºå†…éƒ¨åŒºåŸŸã€‚
>
> æˆ–è€…ï¼Œå¦ä¸€ç§æ–¹æ³•ä½¿ç”¨åˆæˆæ“ä½œï¼šå…ˆç»˜åˆ¶è½®å»“çº¿ï¼Œå†åœ¨ç›¸åŒä½ç½®ä½†å†…éƒ¨åŒºåŸŸç»˜åˆ¶åŸå›¾ï¼Œè¦†ç›–æ‰è½®å»“çº¿çš„å†…éƒ¨éƒ¨åˆ†ï¼Œä»è€Œå®ç°å†…ç¼©çš„æ•ˆæœã€‚
>
> ä¾‹å¦‚ï¼š
>
> 1. ç»˜åˆ¶è½®å»“çº¿ï¼ˆå¦‚é»‘è‰²ï¼‰ã€‚
>
> 2. è®¾ç½®`globalCompositeOperation`ä¸º`source-over`ï¼Œå†ç»˜åˆ¶åŸå›¾ï¼Œä½†åªä¿ç•™åŸå›¾è¦†ç›–éƒ¨åˆ†çš„è½®å»“çº¿å¤–ä¾§éƒ¨åˆ†ã€‚è¿™æ ·å¯èƒ½éœ€è¦å¤åˆ¶åˆ°å¦ä¸€ä¸ªCanvasæˆ–ä½¿ç”¨ç»„åˆæ“ä½œã€‚
>
> å¯èƒ½éœ€è¦æ›´å¤šçš„å›¾å½¢çŸ¥è¯†æ‰èƒ½å‡†ç¡®å®ç°å†…ç¼©æ•ˆæœã€‚
>
> æ­¤æ—¶ç”¨æˆ·çš„åŸä»£ç å¯èƒ½ç¼ºå°‘è¿™éƒ¨åˆ†é€»è¾‘ï¼Œå¯¼è‡´ç±»å‹2çš„æ•ˆæœä¸æ­£ç¡®ã€‚éœ€è¦ç»“åˆç”¨æˆ·æä¾›çš„æšä¸¾å®šä¹‰ï¼Œé‡æ–°åˆ†æä»£ç ä¸­çš„é—®é¢˜ï¼Œå¹¶æä¾›ç›¸åº”çš„ä¿®æ­£æ–¹æ¡ˆã€‚
>
> 



### æ ¹æ® `OutlineImgType` é‡æ–°åˆ†æ `getOutlineImg` æ–¹æ³•é€»è¾‘

---

#### **å…³é”®æšä¸¾å€¼å®šä¹‰**
```typescript
export enum OutlineImgType {
  out_line_img_type_1 = 0,  // çº¯è½®å»“çº¿ï¼ˆSVGæ ¼å¼ï¼‰
  out_line_img_type_2 = 1,  // è½®å»“çº¿ + åŸå›¾å¤–æ‰©ï¼ˆPNGï¼‰
  out_line_img_type_3 = 2,  // è½®å»“çº¿ + åŸå›¾å†…ç¼©ï¼ˆPNGï¼‰
}
```

---

#### **é€»è¾‘ä¿®æ­£ä¸åˆ†ç±»å‹å¤„ç†**

##### **1. ç±»å‹1ï¼ˆçº¯è½®å»“çº¿-SVGï¼‰**
- **ç›®æ ‡**ï¼šç”Ÿæˆä»…åŒ…å«è½®å»“çº¿çš„çŸ¢é‡å›¾ã€‚
- **å®ç°æ–¹å¼**ï¼š
  ```typescript
  if (outlineImgType === OutlineImgType.out_line_img_type_1) {
      // SVGè·¯å¾„æ— éœ€ä¸åŸå›¾å åŠ 
      const svgContent = this.contoursOutLineToSVG(contours, src.cols, src.rows, strokeColor, strokeWidth);
      resultImage = svgContent;
  }
  ```
  - **é—®é¢˜**ï¼š`contoursOutLineToSVG` æ˜¯å¦å¤„ç†å¤–è½®å»“å’Œå†…ç¼©ï¼Ÿéœ€ç¡®ä¿æ‰€æœ‰è·¯å¾„ä»…æè¾¹ï¼Œä¸åŒ…å«å¡«å……ã€‚

##### **2. ç±»å‹2ï¼ˆå¤–æ‰©è½®å»“-PNGï¼‰**
- **ç›®æ ‡**ï¼šå°†åŸå›¾å‘å¤–æ‰©å±•ï¼Œä¸ºè½®å»“çº¿è…¾å‡ºç©ºé—´ï¼Œé¿å…è½®å»“è¢«è£å‰ªã€‚
- **ä¿®æ­£é€»è¾‘**ï¼š
  ```typescript
  let canvasWidth = src.cols;
  let canvasHeight = src.rows;
  let imageOffsetX = 0;
  let imageOffsetY = 0;

  // å¤„ç†å¤–æ‰©ï¼šç”»å¸ƒæ”¾å¤§ï¼ŒåŸå›¾å±…ä¸­åç§»
  if (outlineImgType === OutlineImgType.out_line_img_type_2) {
      canvasWidth = src.cols + strokeWidth * 2; // æ‰©å±•ä¸¤å€è·ç¦»ï¼ˆé¿å…å•è¾¹å¤–æ‰©ï¼‰
      canvasHeight = src.rows + strokeWidth * 2;
      imageOffsetX = strokeWidth;   // åŸå›¾å‘å³ä¸‹æ–¹åç§»
      imageOffsetY = strokeWidth;
  }
  ```
  - **ç»˜åˆ¶æ­¥éª¤**ï¼š
    1. **æ‰©å±•ç”»å¸ƒ**ï¼šå¢åŠ  `2 * strokeWidth`ï¼Œä½¿å¾—åŸå›¾åç§»åä»æœ‰ç©ºé—´å®Œæ•´æ˜¾ç¤ºè½®å»“ã€‚
    2. **ç»˜åˆ¶è½®å»“çº¿**ï¼šç›´æ¥ä½¿ç”¨æå–çš„è½®å»“ç‚¹ã€‚
    3. **åŸå›¾å åŠ **ï¼šç»˜åˆ¶åŸå›¾æ—¶åç§» `strokeWidth`ï¼Œç¡®ä¿è½®å»“å›´ç»•åœ¨åŸå›¾å¤–ä¾§ã€‚
    ```typescript
    ctx.drawImage(image, imageOffsetX, imageOffsetY, src.cols, src.rows);
    ```

##### **3. ç±»å‹3ï¼ˆå†…ç¼©è½®å»“-PNGï¼‰**
- **ç›®æ ‡**ï¼šåœ¨åŸå›¾å†…ä¾§æ˜¾ç¤ºè½®å»“çº¿ï¼Œé¿å…è½®å»“è¢«åŸå›¾è¦†ç›–ã€‚
- **ä¿®æ­£é€»è¾‘**ï¼š
  ```typescript
  if (outlineImgType === OutlineImgType.out_line_img_type_3) {
      // åŸå›¾ç¼©å°ï¼Œå±…ä¸­ç»˜åˆ¶ï¼Œç•™å‡ºè¾¹ç¼˜ç©ºé—´
      ctx.drawImage(
          image, 
          strokeWidth / 2, 
          strokeWidth / 2, 
          src.cols - strokeWidth,   // å®½åº¦å‡å»è¾¹ç¼˜ç©ºé—´
          src.rows - strokeWidth
      );

      // è½®å»“çº¿å‘å†…ç¼©ï¼šä½¿ç”¨è·¯å¾„åç§»
      ctx.save();
      ctx.translate(-strokeWidth / 2, -strokeWidth / 2);
      // ...ç»˜åˆ¶è½®å»“çº¿ï¼ˆéœ€åç§»åæ ‡ï¼‰...
      ctx.restore();

      // æˆ–ç”¨åˆæˆæ¨¡å¼ä»…ä¿ç•™è½®å»“å¤–ä¾§éƒ¨åˆ†
      ctx.globalCompositeOperation = 'destination-out';
      ctx.drawImage(image, 0, 0);
      ctx.globalCompositeOperation = 'source-over';
  }
  ```
  - **æŒ‘æˆ˜**ï¼šå¦‚ä½•å®ç°â€œå†…ç¼©â€è½®å»“ï¼Ÿ
    - **æ–¹æ¡ˆä¸€ï¼ˆç¼©æ”¾åŸå›¾ï¼‰**ï¼šå°†åŸå›¾ç¼©å°å¹¶åœ¨ç”»å¸ƒå±…ä¸­ï¼Œè…¾å‡ºè¾¹ç¼˜ç©ºé—´ç»˜åˆ¶è½®å»“çº¿ã€‚å¯èƒ½å¯¼è‡´å›¾åƒå†…å®¹è¢«å‹ç¼©ã€‚
    - **æ–¹æ¡ˆäºŒï¼ˆè·¯å¾„åç§»ï¼‰**ï¼šå°†è½®å»“ç‚¹åæ ‡å‘å†…åç§» `strokeWidth` çš„åƒç´ è·ç¦»ï¼Œéœ€è¦å¤æ‚çš„å‡ ä½•è®¡ç®—ã€‚
    - **æ–¹æ¡ˆä¸‰ï¼ˆåˆæˆæ“ä½œï¼‰**ï¼šåˆ©ç”¨ `globalCompositeOperation` æ“¦é™¤åŸå›¾é®æŒ¡çš„è½®å»“éƒ¨åˆ†ã€‚

---

#### **ä»£ç ä¿®æ­£ç‚¹æ€»ç»“**
| é—®é¢˜æ¨¡å—         | åŸå®ç°çš„é—®é¢˜                                          | ä¿®æ­£æ–¹æ¡ˆ                                                       |
|------------------|-------------------------------------------------------|----------------------------------------------------------------|
| **ç”»å¸ƒå°ºå¯¸è®¡ç®—** | å¤–æ‰©ç±»å‹ä»…æ‰©å±• `strokeWidth`ï¼Œå¯¼è‡´å•è¾¹å¯èƒ½æº¢å‡º        | æ‰©å±• `2*strokeWidth`ï¼Œç¡®ä¿å››å‘¨å‡åŒ€å¤–æ‰©                        |
| **å†…ç¼©é€»è¾‘ç¼ºå¤±** | ç±»å‹3æœªè°ƒæ•´åŸå›¾ç»˜åˆ¶å°ºå¯¸æˆ–è·¯å¾„                         | ç¼©å°åŸå›¾æˆ–ä½¿ç”¨åˆæˆæ¨¡å¼ï¼Œä»…åœ¨è¾¹ç¼˜ä¿ç•™è½®å»“çº¿                    |
| **è·¯å¾„åç§»å¤„ç†** | å†…ç¼©æ—¶è½®å»“ç›´æ¥ç»˜åˆ¶åœ¨åŸå›¾è¾¹ç¼˜é€ æˆè¦†ç›–                  | å¯¹è½®å»“åæ ‡è¿›è¡Œè´Ÿåç§»ï¼ˆå‘å†…ï¼‰æˆ–è°ƒæ•´åˆæˆç­–ç•¥                    |
| **SVGè·¯å¾„é—­åˆ**  | `closePath()` å¯èƒ½æœªæ­£ç¡®å¤„ç†å¤æ‚è½®å»“ï¼ˆå¦‚å­”æ´ï¼‰        | ç¡®ä¿æ¯ä¸ªè½®å»“å•ç‹¬é—­åˆï¼ŒSVGè·¯å¾„æ·»åŠ  `Z` å‘½ä»¤                    |

---

#### **ä¿®æ­£åæ ¸å¿ƒä»£ç ç¤ºä¾‹**
```typescript
if (outlineImgType === OutlineImgType.out_line_img_type_1) {
    // å¤„ç†ç±»å‹1ï¼šç”ŸæˆSVGè½®å»“
    const svgContent = this.contoursOutLineToSVG(contours, src.cols, src.rows, strokeColor, strokeWidth);
    resultImage = svgContent;
} else {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d')!;

    // åˆå§‹åŒ–ç”»å¸ƒå°ºå¯¸ä¸ä½ç½®
    let canvasWidth = src.cols;
    let canvasHeight = src.rows;
    let imageOffsetX = 0;
    let imageOffsetY = 0;
    let drawWidth = src.cols;
    let drawHeight = src.rows;

    // æ ¹æ®ç±»å‹è°ƒæ•´å‚æ•°
    if (outlineImgType === OutlineImgType.out_line_img_type_2) {
        // å¤–æ‰©é€»è¾‘
        canvasWidth = src.cols + strokeWidth * 2;
        canvasHeight = src.rows + strokeWidth * 2;
        imageOffsetX = strokeWidth;
        imageOffsetY = strokeWidth;
    } else if (outlineImgType === OutlineImgType.out_line_img_type_3) {
        // å†…ç¼©é€»è¾‘ï¼šåŸå›¾ç¼©å°ï¼Œç”»å¸ƒä¸æ‰©å±•
        drawWidth = src.cols - strokeWidth * 2;
        drawHeight = src.rows - strokeWidth * 2;
        imageOffsetX = strokeWidth;
        imageOffsetY = strokeHeight;
    }

    canvas.width = canvasWidth;
    canvas.height = canvasHeight;
    ctx.strokeStyle = strokeColor;
    ctx.lineWidth = strokeWidth;

    // ç»˜åˆ¶æ‰€æœ‰è½®å»“çº¿
    for (let i = 0; i < contours.size(); ++i) {
        const contour = contours.get(i);
        ctx.beginPath();
        // ... éå†ç‚¹ï¼Œå¤„ç†å†…ç¼©åç§» ...
        for (let j = 0; j < contour.rows; ++j) {
            let x = contour.data32S[j * 2];
            let y = contour.data32S[j * 2 + 1];
            // å†…ç¼©ç±»å‹éœ€å‘å†…åç§»
            if (outlineImgType === OutlineImgType.out_line_img_type_3) {
                // å‡è®¾è½®å»“å‘å³ä¸‹åç§»ï¼Œéœ€å°†ç‚¹å‘å·¦ä¸Šåç§»
                x -= strokeWidth;
                y -= strokeWidth;
            }
            if (j === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.stroke();
    }

    // ç»˜åˆ¶åŸå›¾ï¼ˆæ ¹æ®ç±»å‹è°ƒæ•´ä½ç½®å’Œå¤§å°ï¼‰
    ctx.drawImage(image, imageOffsetX, imageOffsetY, drawWidth, drawHeight);

    // è½¬æ¢ä¸ºPNGï¼ˆæˆ–å…¶ä»–æ ¼å¼ï¼‰
    resultImage = canvas.toDataURL('image/png');
}
```

---

#### **éªŒè¯ä¸æµ‹è¯•å»ºè®®**
1. **å¤–æ‰©éªŒè¯**ï¼šæ£€æŸ¥ç”Ÿæˆå›¾ç‰‡å°ºå¯¸æ˜¯å¦å¤§äºåŸå›¾ï¼Œä¸”è½®å»“å›´ç»•åœ¨åŸå›¾å¤–ä¾§ã€‚
2. **å†…ç¼©éªŒè¯**ï¼šåŸå›¾è¾¹ç¼˜åº”ç•™å‡ºç©ºé—´ï¼Œè½®å»“çº¿ç´§è´´åŸå›¾å†…ä¾§ï¼Œæœªè¢«é®æŒ¡ã€‚
3. **ç±»å‹è¦†ç›–æµ‹è¯•**ï¼šåˆ†åˆ«ä¼ å…¥æšä¸¾0/1/2ï¼Œç¡®è®¤ä¸‰ç§æ¨¡å¼è¾“å‡ºç¬¦åˆé¢„æœŸã€‚




> ğŸ’­ å¥½çš„ï¼Œæˆ‘ç°åœ¨è¦ä»”ç»†ç†è§£ç”¨æˆ·æä¾›çš„ `getOutlineImg` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼¼ä¹æ˜¯ç”¨ OpenCV.js å¤„ç†å›¾åƒï¼Œç„¶åæ ¹æ®ä¸åŒçš„è½®å»“ç±»å‹ç”Ÿæˆ SVG æˆ–å¸¦æè¾¹çš„å›¾åƒã€‚æˆ‘æ˜¯å›¾å½¢å­¦å’Œ OpenCV çš„æ–°æ‰‹ï¼Œæ‰€ä»¥éœ€è¦æ…¢æ…¢æ‹†è§£æ¯ä¸€æ­¥ã€‚
>
> é¦–å…ˆçœ‹æ–¹æ³•çš„å‚æ•°ï¼š
>
> - `imageStr`ï¼šåº”è¯¥æ˜¯ base64 ç¼–ç çš„å›¾ç‰‡å­—ç¬¦ä¸²ã€‚
>
> - `outlineImgType`ï¼šè½®å»“ç±»å‹ï¼Œé»˜è®¤ä¸ºç±»å‹1ã€‚è¿™å¯èƒ½å†³å®šæœ€ç»ˆè¾“å‡ºæ˜¯ SVG è¿˜æ˜¯ PNGã€‚
>
> - `strokeWidth` å’Œ `strokeColor`ï¼šæ§åˆ¶è½®å»“çš„ç²—ç»†å’Œé¢œè‰²ã€‚
>
> æ–¹æ³•çš„æ€»ä½“æµç¨‹å¤§æ¦‚æ˜¯ï¼š
>
> 1. å°† base64 è½¬æˆå›¾ç‰‡å¯¹è±¡ã€‚
>
> 2. ç”¨ OpenCV å¤„ç†å›¾ç‰‡ï¼Œè½¬ä¸ºç°åº¦å›¾ï¼ŒäºŒå€¼åŒ–ï¼Œæ‰¾è½®å»“ã€‚
>
> 3. æ ¹æ®ä¸åŒçš„è½®å»“ç±»å‹ï¼Œç”Ÿæˆå¯¹åº”çš„ç»“æœå›¾åƒï¼ˆSVG æˆ–å¸¦æè¾¹çš„ PNGï¼‰ã€‚è¿™åœ°æ–¹åˆ†ææœ‰é”™è¯¯åº”è¯¥æ­»è¿™æ ·çš„export enum OutlineImgType {
  out_line_img_type_1 = 0,  // è·å–è½®å»“çº¿
  out_line_img_type_2 = 1,  // è·å–è½®å»“çº¿+åŸå›¾å¤–æ‰©
  out_line_img_type_3 = 2,  // è·å–è½®å»“çº¿+åŸå›¾å†…ç¼©
}
>
> 4. æ¸…ç† OpenCV çš„å†…å­˜å ç”¨ã€‚
>
> æ¥ä¸‹æ¥æˆ‘éœ€è¦åˆ†æ­¥éª¤ç†è§£æ¯ä¸ªéƒ¨åˆ†åšä»€ä¹ˆï¼Œå¹¶ç¡®å®šæ˜¯å¦æœ‰æ½œåœ¨é—®é¢˜ã€‚
>
> é¦–å…ˆï¼Œ`base64ToImage` çš„æ­£ç¡®æ€§å¦‚ä½•ï¼Ÿå¯èƒ½æ˜¯ç”¨æˆ·è‡ªå®šä¹‰æ–¹æ³•ï¼Œå‡è®¾å®ƒèƒ½æ­£å¸¸å·¥ä½œã€‚
>
> OpenCV éƒ¨åˆ†ï¼š
>
> - `imread` è¯»å–å›¾ç‰‡æ•°æ®åˆ°çŸ©é˜µ `src`ã€‚
>
> - `cvtColor` è½¬ç°åº¦å›¾ `gray`ã€‚
>
> - `threshold` è½¬æ¢æˆäºŒå€¼å›¾åƒ `binary`ã€‚
>
> - `findContours` æŸ¥æ‰¾å¤–è½®å»“ï¼Œå­˜å‚¨åˆ° `contours` å’Œ `hierarchy`ã€‚
>
> è¿™é‡Œä½¿ç”¨ `RETR_EXTERNAL` æ£€ç´¢æ¨¡å¼ï¼Œæ„å‘³ç€åªæ£€æµ‹æœ€å¤–å±‚è½®å»“ï¼Œå¿½ç•¥å­”æ´ã€‚è€Œ `CHAIN_APPROX_TC89_KCOS` æ˜¯è½®å»“è¿‘ä¼¼æ–¹æ³•ï¼Œä¼˜åŒ–å­˜å‚¨ï¼Œå‡å°‘ç‚¹æ•°ã€‚
>
> æ¥ä¸‹æ¥æ ¹æ® `outlineImgType` å¤„ç†ä¸¤ç§ä¸åŒçš„ç±»å‹ï¼š
>
> å½“ç±»å‹ä¸æ˜¯1çš„æ—¶å€™ï¼Œåˆ›å»º `<canvas>` å¹¶åœ¨ä¸Šé¢ç»˜åˆ¶è½®å»“å’ŒåŸå›¾ï¼š
>
> - å¦‚æœæ˜¯ç±»å‹2ï¼Œç”»å¸ƒå°ºå¯¸ä¼šå¢åŠ  `strokeWidth`ï¼Œæè¾¹å±…ä¸­ï¼Œç„¶åç»˜åˆ¶åŸå›¾ã€‚
>
> - å…¶ä»–ç±»å‹ï¼ˆæ¯”å¦‚ç±»å‹3ï¼‰ï¼Œç”»å¸ƒå°ºå¯¸ä¸åŸå›¾ç›¸åŒï¼Œç›´æ¥åœ¨åŸä½ç½®ç»˜å›¾ï¼Œæœ€åå¯èƒ½æœ‰ `globalCompositeOperation` æœªè¢«æ³¨é‡Šçš„ä»£ç ï¼Œä¼¼ä¹æ˜¯æƒ³å®ç°æŸç§æ··åˆæ•ˆæœã€‚
>
> å¯¹äº SVG ç±»å‹ï¼ˆç±»å‹1ï¼‰ï¼Œè°ƒç”¨ `contoursOutLineToSVG` æ–¹æ³•ç”Ÿæˆ SVG å­—ç¬¦ä¸²ã€‚
>
> é—®é¢˜ç‚¹æˆ–è®¸åœ¨ï¼š
>
> 1. **å†…å­˜æ³„æ¼**ï¼šæ˜¯å¦æ­£ç¡®é‡Šæ”¾æ‰€æœ‰ OpenCV çš„ Mat å’Œ MatVectorï¼Ÿ
>
> 2. **Canvas å¤„ç†**ï¼šæ˜¯å¦æ­£ç¡®å¤„ç†äº†æè¾¹çš„åç§»ï¼Ÿç‰¹åˆ«æ˜¯ç±»å‹2çš„ `strokeWidth/2` æ˜¯å¦è®¡ç®—æ­£ç¡®ï¼Ÿ
>
> 3. **æ€§èƒ½é—®é¢˜**ï¼šé¢‘ç¹åˆ›å»ºå’Œé‡Šæ”¾ç”»å¸ƒæ˜¯å¦å½±å“æ€§èƒ½ï¼Ÿ
>
> 4. **`contoursOutLineToSVG` æ˜¯å¦æ­£ç¡®ç”ŸæˆSVGè·¯å¾„**ã€‚
>
> 5. **`globalCompositeOperation` è¢«æ³¨é‡Šæ‰æ˜¯å¦å½±å“å†…å®¹**ï¼Ÿ
>
> 6. **OpenCV ä¸­ `threshold` çš„é˜ˆå€¼æ˜¯å¦åˆç†**ï¼Ÿå‚æ•°ä¸­çš„ `0` å’Œ `255` æ˜¯å¦å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ï¼Ÿ
>
> 7. **å›¾åƒå°ºå¯¸æ˜¯å¦ä¸ç”»å¸ƒæ­£ç¡®å¯¹åº”**ï¼Œæ˜¯å¦å­˜åœ¨å›¾åƒè¢«æ‹‰ä¼¸æˆ–åç§»ï¼Ÿ
>
> éœ€è¦æ³¨æ„ï¼Œ`findContours` åœ¨ OpenCV.js ä¸­çš„è¡¨ç°å¯èƒ½ä¸åŸç”Ÿæœ‰å·®å¼‚ï¼Œæ˜¯å¦å½±å“äº†è½®å»“çš„å‡†ç¡®æ€§ï¼Ÿ
>
> å¦å¤–ï¼Œåœ¨å¤„ç†è½®å»“éå†æ—¶ï¼Œæå– `contour.data32S` çš„æ–¹å¼æ˜¯å¦æ­£ç¡®ï¼Ÿæ¯ä¸ªç‚¹æ˜¯å­˜å‚¨åœ¨ `data32S` ä¸­çš„ï¼Œç´¢å¼•è®¿é—®æ˜¯å¦æ­£ç¡®ï¼Ÿæ¯”å¦‚ä¸€ä¸ªç‚¹å¯èƒ½æ˜¯ (x, y)ï¼Œæ‰€ä»¥ j*2 å’Œ j*2+1 æ˜¯å¯¹çš„ã€‚
>
> åœ¨ç”Ÿæˆ SVG æ—¶ï¼Œ`contoursOutLineToSVG` çš„å®ç°å¯èƒ½éœ€è¦æ­£ç¡®è½¬æ¢è½®å»“ç‚¹ä¸º SVG è·¯å¾„ï¼Œå¦‚æœè¿™ä¸€æ­¥æ²¡æœ‰çœ‹åˆ°å…·ä½“ä»£ç ï¼Œå¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œå¦‚æ˜¯å¦æ‰€æœ‰è½®å»“éƒ½è¢«å¤„ç†ï¼Œé—­åˆè·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚
>
> è¿˜æœ‰ï¼Œåœ¨ç±»å‹é1çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°çš„ `resultImage` æ˜¯ PNG çš„ data URLï¼Œè€Œç±»å‹1ç”Ÿæˆ SVG å­—ç¬¦ä¸²ã€‚ä¸¤ç§è¾“å‡ºæ ¼å¼ä¸åŒæ˜¯å¦ä¼šå¯¼è‡´åç»­ä½¿ç”¨é—®é¢˜ï¼Ÿ
>
> ä¾‹å¦‚ï¼Œå¦‚æœåç»­éœ€è¦ç»Ÿä¸€æ ¼å¼ï¼Œæˆ–è€… SVG ç›¸å¯¹äº PNG çš„ä¼˜åŠ¿æ˜¯å¦èƒ½æ»¡è¶³éœ€æ±‚ï¼Ÿ
>
> æ­¤å¤–ï¼Œ`strokeWidth` çš„å¤„ç†ï¼Œæ¯”å¦‚åœ¨ç±»å‹2ä¸­æ·»åŠ é¢å¤–çš„ç”»å¸ƒç©ºé—´æ˜¯å¦è¶³å¤Ÿå®¹çº³æ•´ä¸ªæè¾¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæè¾¹å¾ˆç²—ï¼Œå¢åŠ  `strokeWidth` æ˜¯å¦ä¿è¯ä¸ä¼šè£å‰ªï¼Ÿå¯èƒ½éœ€è¦è®¡ç®—éœ€è¦æ‰©å¤§å¤šå°‘å°ºå¯¸ã€‚
>
> å¯¹äºé”™è¯¯å¤„ç†ï¼šæ˜¯å¦æœ‰è€ƒè™‘è½®å»“æ‰¾ä¸åˆ°çš„æƒ…å†µï¼Ÿè¿™æ—¶ç»“æœå¯èƒ½ä¸ºç©ºæˆ–å¼‚å¸¸ã€‚
>
> å¦å¤–ï¼Œåœ¨ Canvas ç»˜å›¾æ—¶ï¼Œ`closePath()` å’Œ `stroke()` æ˜¯å¦ç¡®ä¿äº†è½®å»“é—­åˆï¼Ÿå¦‚æœåœ¨æŸäº›è½®å»“ä¸é—­åˆçš„æƒ…å†µä¸‹ï¼Œæ•ˆæœå¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚
>
> æœ€åï¼Œ`src.delete()` è¿™ç­‰æ¸…ç†æ˜¯å¦å½»åº•ï¼Œæ¯”å¦‚æ‰€æœ‰åˆ›å»ºçš„ Mat å¯¹è±¡éƒ½è¢«é‡Šæ”¾äº†ï¼Ÿä¾‹å¦‚ `gray`, `binary`, `contours`, `hierarchy` éƒ½è°ƒç”¨äº† `delete()`ï¼Œçœ‹èµ·æ¥æ²¡é—®é¢˜ã€‚
>
> å¯èƒ½å­˜åœ¨çš„ä¼˜åŒ–ç‚¹ï¼š
>
> 1. å¯ä»¥é‡ç”¨åŒä¸€ä¸ª Canvas è€Œä¸æ˜¯æ¯æ¬¡åˆ›å»ºï¼Œä½†éœ€è¦æµ‹è¯•é‡Šæ”¾æ˜¯å¦å½»åº•ã€‚
>
> 2. åœ¨ SVG ç”Ÿæˆæ—¶æ˜¯å¦éœ€è¦ä¼˜åŒ–è·¯å¾„ç‚¹æ•°ï¼Œæ¯”å¦‚ä½¿ç”¨ç®€åŒ–ï¼ˆRamer-Douglas-Peucker ç®—æ³•ï¼‰ä»¥å‡å°‘ç‚¹æ•°ã€‚
>
> 3. æŸäº›å‚æ•°å¯èƒ½å¯ä»¥é…ç½®ï¼Œå¦‚äºŒå€¼åŒ–çš„é˜ˆå€¼æ–¹å¼ï¼ˆå½“å‰ç”¨çš„æ˜¯ `THRESH_BINARY`ï¼Œæ˜¯å¦åº”è¯¥è‡ªåŠ¨è®¡ç®—é˜ˆå€¼ï¼Ÿä½¿ç”¨å¤§æ´¥æ³•ç­‰å¯èƒ½ä¼šæ›´é²æ£’ï¼‰ã€‚
>
> æ€»ä½“æ¥è¯´ï¼Œæ–¹æ³•çš„åŸºæœ¬æµç¨‹åˆç†ï¼Œä½†ä»éœ€éªŒè¯å†…å­˜æ˜¯å¦æ­£ç¡®ç®¡ç†ï¼Œè·¯å¾„ç‚¹æ˜¯å¦æ­£ç¡®å¤„ç†ï¼Œä»¥åŠè¾“å‡ºç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚
>
> 



### `getOutlineImg` æ–¹æ³•è¯¦ç»†è§£æ

#### **åŠŸèƒ½æ¦‚è¿°**
è¯¥æ–¹æ³•å°†è¾“å…¥çš„å›¾åƒï¼ˆBase64 å­—ç¬¦ä¸²ï¼‰å¤„ç†ä¸ºå¸¦è½®å»“çš„ SVG æˆ– Canvas å›¾åƒã€‚æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
- **æ¨¡å¼1**ï¼šç”ŸæˆçŸ¢é‡ SVG è·¯å¾„è½®å»“ã€‚
- **æ¨¡å¼2/å…¶ä»–**ï¼šåœ¨ Canvas ä¸Šç»˜åˆ¶æè¾¹è½®å»“å¹¶å åŠ åŸå›¾ï¼Œç”Ÿæˆ PNGã€‚

---

#### **æ­¥éª¤æ‹†è§£**

##### **1. å›¾åƒåŸº64è§£ç ï¼ˆ`base64ToImage`ï¼‰**
- è¾“å…¥ `imageStr` è½¬æ¢ä¸º `HTMLImageElement`ï¼Œå‡è®¾ `base64ToImage` æ–¹æ³•å®ç°æ­£ç¡®ã€‚

##### **2. OpenCV å›¾åƒå¤„ç†**
```typescript
const src = this.cv.imread(image);    // åŠ è½½å›¾åƒåˆ°OpenCVçŸ©é˜µ
const gray = new this.cv.Mat();
this.cv.cvtColor(src, gray, this.cv.COLOR_RGBA2GRAY, 0); // è½¬ä¸ºç°åº¦å›¾
```
- `imread` ä¼šè¯»å–å›¾åƒåƒç´ åˆ° `src`ï¼Œæ³¨æ„ OpenCV.js å¯èƒ½éœ€è¦å›¾åƒå®Œå…¨åŠ è½½åæ‰æ“ä½œã€‚

```typescript
const binary = new this.cv.Mat();
this.cv.threshold(gray, binary, 0, 255, this.cv.THRESH_BINARY); // äºŒå€¼åŒ–
```
- `threshold` å°†ç°åº¦å›¾è½¬ä¸ºé»‘ç™½äºŒå€¼å›¾ï¼Œå‚æ•° `0` è¡¨ç¤ºè‡ªåŠ¨é˜ˆå€¼ï¼ˆéœ€ç”¨ `THRESH_OTSU` æ›´å‡†ç¡®ï¼‰ã€‚**æ­¤å¤„é—®é¢˜**ï¼šä½¿ç”¨`THRESH_BINARY`å’Œå›ºå®šé˜ˆå€¼0å¯èƒ½å¯¼è‡´é”™è¯¯åˆ†å‰²ï¼

```typescript
const contours = new this.cv.MatVector(); 
const hierarchy = new this.cv.Mat();
this.cv.findContours(binary, contours, hierarchy, this.cv.RETR_EXTERNAL, this.cv.CHAIN_APPROX_TC89_KCOS);
```
- `findContours` æå–å¤–è½®å»“ï¼ˆ`RETR_EXTERNAL`ï¼‰:
  - **RETR_EXTERNAL**: ä»…æ£€æµ‹æœ€å¤–å±‚è½®å»“ï¼ˆå¿½ç•¥å†…éƒ¨å­”æ´ï¼‰ã€‚
  - **CHAIN_APPROX_TC89_KCOS**: ä½¿ç”¨ Teh-Chin é“¾é€¼è¿‘ç®—æ³•ï¼Œå‡å°‘è½®å»“ç‚¹æ•°ã€‚

##### **3. è½®å»“å¤„ç†ä¸å¯è§†åŒ–**
æ ¹æ® `outlineImgType` åˆ†æ”¯å¤„ç†ï¼š

###### **æ¨¡å¼2/å…¶ä»–ï¼ˆç”Ÿæˆ PNGï¼‰**
```typescript
// åˆ›å»ºCanvas
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
```
- **æ¨¡å¼2æ‰©å±•ç”»å¸ƒå°ºå¯¸**ï¼ˆä¸ºæè¾¹ç•™ç©ºé—´ï¼‰ï¼š
  ```typescript
  canvas.width = src.cols + strokeWidth;
  canvas.height = src.rows + strokeWidth;
  ```
  åç§»ç»˜åˆ¶åæ ‡ï¼š
  ```typescript
  ctx.moveTo(x + strokeWidth/2, y + strokeWidth/2); // ç¡®ä¿æè¾¹ä¸è¶Šç•Œ
  ```

- **å…¶ä»–æ¨¡å¼ä¸æ‰©å±•ç”»å¸ƒ**ï¼Œç›´æ¥ç»˜åˆ¶åœ¨åŸä½ç½®ï¼š
  ```typescript
  ctx.moveTo(x, y); 
  ```

**å…³é”®ç»˜å›¾é€»è¾‘ï¼š**
1. **éå†æ‰€æœ‰è½®å»“**ï¼š
   ```typescript
   for (let i = 0; i < contours.size(); ++i) {
       const contour = contours.get(i); // è·å–ç¬¬iä¸ªè½®å»“
       // éå†è½®å»“ç‚¹
       for (let j = 0; j < contour.rows; ++j) {
           const x = contour.data32S[j * 2];     // xåæ ‡
           const y = contour.data32S[j * 2 + 1]; // yåæ ‡
           if (j === 0) ctx.moveTo(x, y); 
           else ctx.lineTo(x, y);
       }
       ctx.closePath(); // é—­åˆè·¯å¾„
       ctx.stroke();    // ç»˜åˆ¶æè¾¹
   }
   ```
   - `contour.data32S` å­˜å‚¨è½®å»“ç‚¹ï¼Œæ¯ä¸ªç‚¹å ä¸¤ä¸ªintï¼ˆ32ä½æœ‰ç¬¦å·ï¼‰ï¼Œç´¢å¼•æ­£ç¡®æ€§å·²éªŒè¯ã€‚
   
2. **å åŠ åŸå›¾**ï¼š
   ```typescript
   ctx.drawImage(image, strokeWidth/2, strokeWidth/2, src.cols, src.rows); // æ¨¡å¼2
   ctx.drawImage(image, 0, 0, src.cols, src.rows); // å…¶ä»–æ¨¡å¼
   ```
   - **æ¨¡å¼2éœ€åç§»å›¾åƒä½ç½®**ä»¥åŒ¹é…æ‰©å¤§çš„ç”»å¸ƒï¼Œå¦åˆ™å›¾åƒå¯èƒ½é”™ä½ã€‚

###### **æ¨¡å¼1ï¼ˆç”Ÿæˆ SVGï¼‰**
```typescript
const svgContent = this.contoursOutLineToSVG(contours, src.cols, src.rows, strokeColor, strokeWidth);
resultImage = svgContent;
```
- **å‡è®¾ `contoursOutLineToSVG` æ­£ç¡®å®ç°**: éœ€éå†æ‰€æœ‰è½®å»“ç”Ÿæˆ `<path>` å…ƒç´ ï¼Œå¦‚ï¼š
  ```svg
  <svg width="cols" height="rows">
    <path d="Mx1,y1 Lx2,y2 ... Z" stroke="color" stroke-width="width" fill="none"/>
  </svg>
  ```

##### **4. æ¸…ç†èµ„æº**
```typescript
src.delete(); gray.delete(); binary.delete(); contours.delete(); hierarchy.delete();
```
- **å¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ OpenCV.js çš„ Mat/MatVector å¯¹è±¡**ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

---

#### **æ½œåœ¨é—®é¢˜ä¸ä¼˜åŒ–å»ºè®®**

##### **é—®é¢˜æ¸…å•**
| é—®é¢˜ç‚¹ | å¯èƒ½å½±å“ | å»ºè®®ä¿®å¤æ–¹æ¡ˆ |
|--------|----------|--------------|
| **é˜ˆå€¼åˆ†å‰²æ–¹å¼** | é”™è¯¯åˆ†å‰²å¯¼è‡´è½®å»“ä¸å‡† | æ”¹ç”¨`THRESH_OTSU`è‡ªåŠ¨è®¡ç®—é˜ˆå€¼ï¼š`this.cv.THRESH_BINARY \| this.cv.THRESH_OTSU` |
| **æœªå¤„ç†ç©ºè½®å»“** | æ— è½®å»“æ—¶è¿”å›ç©ºå›¾åƒ | æ·»åŠ åˆ¤æ–­ï¼š`if (contours.size() === 0) reject("æ— è½®å»“")` |
| **æ¨¡å¼2æè¾¹æº¢å‡º** | æè¾¹è¾ƒç²—æ—¶è¶…å‡ºè¾¹ç¼˜ | ç¡®ä¿ç”»å¸ƒæ‰©å±•è¶³å¤Ÿï¼š `strokeWidth`çš„åç§»è®¡ç®—éœ€æ£€æŸ¥æ˜¯å¦è¶³å¤Ÿå­˜ç•™ |
| **ä»£ç å†—ä½™** | ç»´æŠ¤å›°éš¾ | åˆå¹¶æ¨¡å¼2å’Œå…¶ä»–æ¨¡å¼çš„Canvasç»˜åˆ¶é€»è¾‘ï¼Œå‡å°‘é‡å¤ä»£ç  |

##### **OpenCV.js æ³¨æ„äº‹é¡¹**
- **åŒæ­¥ä»£ç æ‰§è¡Œ**ï¼šç¡®ä¿å¼‚æ­¥æ“ä½œï¼ˆå¦‚å›¾ç‰‡åŠ è½½ï¼‰å®Œæˆåå†è°ƒç”¨ OpenCV æ–¹æ³•ã€‚
- **å†…å­˜ç®¡ç†**ï¼šæ‰€æœ‰ `Mat` å’Œ `MatVector` **å¿…é¡»ä¸»åŠ¨é‡Šæ”¾**ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

##### **æ¼”ç¤ºä»£ç ä¿®æ­£**
```typescript
// ä¿®å¤é˜ˆå€¼å¤„ç†ï¼ˆå¯ç”¨å¤§æ´¥æ³•ï¼‰
this.cv.threshold(gray, binary, 0, 255, this.cv.THRESH_BINARY | this.cv.THRESH_OTSU);

// æ·»åŠ ç©ºè½®å»“å¤„ç†
if (contours.size() === 0) {
    console.warn("æœªæ£€æµ‹åˆ°è½®å»“");
    return "";
}

// åˆå¹¶Canvasç»˜åˆ¶é€»è¾‘
function drawContours(ctx: CanvasRenderingContext2D, contours: cv.MatVector, offset: number) {
    ctx.beginPath();
    // å¾ªç¯è½®å»“å’Œç‚¹...
}
```

---

#### **æ€»ç»“**
è¯¥æ–¹æ³•é€šè¿‡ OpenCV.js å®ç°å›¾åƒè½®å»“æå–ï¼Œå¹¶æ ¹æ®éœ€æ±‚ç”ŸæˆçŸ¢é‡åŒ–æˆ–å…‰æ …åŒ–ç»“æœã€‚**æ ¸å¿ƒæ³¨æ„ç‚¹**ï¼š
1. **é˜ˆå€¼åˆ†å‰²å‡†ç¡®æ€§**ï¼šä½¿ç”¨è‡ªåŠ¨é˜ˆå€¼ç®—æ³•æå‡é²æ£’æ€§ã€‚
2. **å†…å­˜å®‰å…¨ç®¡ç†**ï¼šç¡®ä¿ OpenCV å¯¹è±¡é‡Šæ”¾ã€‚
3. **è½®å»“å¤„ç†å®Œæ•´æ€§**ï¼šå¤„ç†ç©ºè½®å»“æƒ…å†µï¼Œä¼˜åŒ–è·¯å¾„ç”Ÿæˆã€‚
4. **SVG/CANVAS é€»è¾‘ä¼˜åŒ–**ï¼šå‡å°‘é‡å¤ä»£ç ï¼Œç»Ÿä¸€ç»˜åˆ¶è·¯å¾„ã€‚
